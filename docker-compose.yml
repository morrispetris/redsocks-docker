version: "3.8"

services:
  redsocks:
    image: .                      # or your ubuntu-based redsocks image
    container_name: redsocks
    restart: unless-stopped
    network_mode: host            # important so redsocks can redirect host traffic
    cap_add:
      - NET_ADMIN                 # required for iptables rules
      - NET_RAW
    extra_hosts:
      - "host.docker.internal:host-gateway"
    environment:
      PROXY_SERVER: 127.0.0.1     # 0.0.0.0:1080 reachable from container
      PROXY_PORT: 1080
      PROXY_TYPE: socks5          # socks5 or http
      REDIRECT_PORTS: "all"       # redirect all outbound traffic
